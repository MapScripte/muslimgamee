<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MathGame - Калькулятор нұсқасы</title>
    <style>
        :root {
            --primary: #4a90e2;
            --success: #48c774;
            --danger: #ff3860;
            --bg: #f0f2f5;
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            justify-content: center;
            touch-action: manipulation;
        }
        #app {
            width: 100%;
            max-width: 450px;
            background: white;
            min-height: 100vh;
            padding: 15px;
            box-sizing: border-box;
            text-align: center;
            display: flex;
            flex-direction: column;
        }
        .screen { display: none; flex-grow: 1; }
        .active { display: flex; flex-direction: column; }
        
        /* Мәзір стильдері */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .num-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        
        button {
            padding: 15px 5px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
        }
        button:active { transform: scale(0.92); opacity: 0.8; }
        .btn-main { background: var(--primary); color: white; }
        .btn-num { background: #6c5ce7; color: white; }
        .btn-mix { background: #fdb827; color: white; grid-column: span 3; }
        .btn-back { background: #636e72; color: white; margin-top: 15px; width: 100%; }

        /* Ойын экраны */
        #question { font-size: 55px; margin: 20px 0; color: #2d3436; font-weight: bold; }
        #display {
            font-size: 40px;
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 10px;
            height: 60px;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--primary);
        }
        
        /* Цифрлық пернетақта */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: auto;
            padding-bottom: 20px;
        }
        .key {
            background: #e1e8ed;
            color: #333;
            font-size: 24px;
            padding: 20px;
            border-radius: 15px;
        }
        .key-del { background: #fab1a0; }
        .key-enter { background: var(--success); color: white; grid-column: span 2; }

        #feedback { font-size: 18px; font-weight: bold; height: 25px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="app">
    <div id="home" class="screen active">
        <h2 style="color: var(--primary);">Математика әлемі</h2>
        <div class="grid">
            <button class="btn-main" onclick="start('add', 0)">Қосу (+)</button>
            <button class="btn-main" onclick="start('sub', 0)">Азайту (-)</button>
            <button class="btn-main" onclick="openMenu('mul-menu')">Көбейту (×)</button>
            <button class="btn-main" onclick="openMenu('div-menu')">Бөлу (÷)</button>
        </div>
    </div>

    <div id="mul-menu" class="screen">
        <h3>Көбейту кестесі</h3>
        <div class="num-grid" id="mul-list"></div>
        <button class="btn-back" onclick="openMenu('home')">Артқа</button>
    </div>

    <div id="div-menu" class="screen">
        <h3>Бөлуді үйрену</h3>
        <div class="num-grid" id="div-list"></div>
        <button class="btn-back" onclick="openMenu('home')">Артқа</button>
    </div>

    <div id="game" class="screen">
        <div id="question"></div>
        <div id="display"></div>
        <div id="feedback"></div>
        
        <div class="keypad">
            <button class="key" onclick="press(1)">1</button>
            <button class="key" onclick="press(2)">2</button>
            <button class="key" onclick="press(3)">3</button>
            <button class="key" onclick="press(4)">4</button>
            <button class="key" onclick="press(5)">5</button>
            <button class="key" onclick="press(6)">6</button>
            <button class="key" onclick="press(7)">7</button>
            <button class="key" onclick="press(8)">8</button>
            <button class="key" onclick="press(9)">9</button>
            <button class="key" onclick="press(0)">0</button>
            <button class="key key-del" onclick="press('del')">⌫</button>
            <button class="key key-enter" onclick="check()">Тексеру</button>
        </div>
        <button class="btn-back" onclick="openMenu('home')">Мәзірге қайту</button>
    </div>
</div>

<script>
    let currentMode = '';
    let selectedNum = 0;
    let correctAnswer = 0;
    let usedQuestions = new Set();
    let userInput = "";

    // Түймелерді дайындау
    const mList = document.getElementById('mul-list');
    const dList = document.getElementById('div-list');
    for(let i=1; i<=9; i++) {
        mList.innerHTML += `<button class="btn-num" onclick="start('mul', ${i})">${i}</button>`;
        dList.innerHTML += `<button class="btn-num" onclick="start('div', ${i})">${i}</button>`;
    }
    mList.innerHTML += `<button class="btn-mix" onclick="start('mul', 0)">Аралас кесте</button>`;
    dList.innerHTML += `<button class="btn-mix" onclick="start('div', 0)">Аралас бөлу</button>`;

    function openMenu(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function start(mode, num) {
        currentMode = mode;
        selectedNum = num;
        usedQuestions.clear();
        userInput = "";
        openMenu('game');
        nextQuestion();
    }

    function press(num) {
        if (num === 'del') {
            userInput = userInput.slice(0, -1);
        } else {
            if (userInput.length < 3) userInput += num;
        }
        document.getElementById('display').innerText = userInput;
    }

    function playSound(isOk) {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(isOk ? 600 : 250, audioCtx.currentTime);
        if(isOk) osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }

    function nextQuestion() {
        let n1, n2, txt;
        let found = false;
        let limit = 0;

        while (!found && limit < 100) {
            if (currentMode === 'add') {
                n1 = Math.floor(Math.random() * 90) + 1;
                n2 = Math.floor(Math.random() * (100 - n1));
                correctAnswer = n1 + n2; txt = `${n1} + ${n2}`;
            } 
            else if (currentMode === 'sub') {
                n1 = Math.floor(Math.random() * 99) + 1;
                n2 = Math.floor(Math.random() * n1);
                correctAnswer = n1 - n2; txt = `${n1} - ${n2}`;
            }
            else if (currentMode === 'mul') {
                n1 = (selectedNum === 0) ? Math.floor(Math.random() * 9) + 1 : selectedNum;
                n2 = Math.floor(Math.random() * 9) + 1;
                correctAnswer = n1 * n2; txt = `${n1} × ${n2}`;
            }
            else if (currentMode === 'div') {
                n2 = (selectedNum === 0) ? Math.floor(Math.random() * 9) + 1 : selectedNum;
                correctAnswer = Math.floor(Math.random() * 9) + 1;
                n1 = n2 * correctAnswer;
                txt = `${n1} ÷ ${n2}`;
            }
            if (!usedQuestions.has(txt)) { usedQuestions.add(txt); found = true; }
            limit++;
        }

        if (limit >= 100) usedQuestions.clear();
        document.getElementById('question').innerText = txt;
        userInput = "";
        document.getElementById('display').innerText = "";
        document.getElementById('feedback').innerText = "";
    }

    function check() {
        if (userInput === "") return;
        const val = parseInt(userInput);
        const fb = document.getElementById('feedback');

        if (val === correctAnswer) {
            fb.innerText = "Дұрыс! Жарайсың! ✨";
            fb.style.color = "var(--success)";
            playSound(true);
            setTimeout(nextQuestion, 1000);
        } else {
            fb.innerText = "Қате, қайта ойлан! ❌";
            fb.style.color = "var(--danger)";
            playSound(false);
            userInput = "";
            document.getElementById('display').innerText = "";
        }
    }
</script>

</body>
</html>